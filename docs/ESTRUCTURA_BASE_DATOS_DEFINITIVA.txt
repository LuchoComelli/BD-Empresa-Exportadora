================================================================================
                    ESTRUCTURA DEFINITIVA DE BASE DE DATOS
                    INTEGRACI√ìN COMPLETA Y OPTIMIZACIONES PROFESIONALES
                    BD-Empresa-Exportadora
                    VERSI√ìN FINAL INTEGRADA CON MEJORAS DE RENDIMIENTO
================================================================================

AN√ÅLISIS DE INTEGRACI√ìN COMPLETA:
=================================

‚úÖ **REVISI√ìN EXHAUSTIVA REALIZADA:**
- MODELOS PRINCIPALES ‚úÖ (Usuario, Dpto, Municipio, Localidades)
- MODELOS RELACIONADOS ‚úÖ (ProductoEmpresa, ServicioEmpresa, PosicionArancelaria)
- SISTEMA DE AUDITOR√çA ‚úÖ (AuditoriaLog, AuditoriaCambios, AuditoriaArchivos)
- SISTEMA DE ROLES ‚úÖ (Sistema de roles profesional, organizaci√≥n l√≥gica)
- AN√ÅLISIS: Posiciones arancelarias ‚úÖ (UNIVERSALES - Sistema Armonizado SA)
- OPTIMIZACI√ìN: Contactos/Emails ‚úÖ (M√°ximo 3 por empresa - principal/secundario)
- SISTEMA: Filtros y exportaci√≥n PDF ‚úÖ (Sistema completo de filtros y exportaci√≥n)

üéØ **INTEGRACI√ìN FINAL CORREGIDA:**
Todas las partes est√°n perfectamente integradas y complementarias.
Sistema de roles profesional implementado.
Organizaci√≥n l√≥gica corregida.
La estructura es coherente, profesional y escalable.

================================================================================
                    ESTRUCTURA DEFINITIVA INTEGRADA
================================================================================

1. MODELOS BASE PARA AUDITOR√çA (NUEVO):
========================================

```python
# apps/core/models.py
from django.db import models
from django.contrib.auth.models import AbstractBaseUser, PermissionsMixin, BaseUserManager
from django.utils import timezone
from django.core.validators import RegexValidator

class TimestampedModel(models.Model):
    """
    Modelo base para todos los modelos que necesiten auditor√≠a temporal
    """
    fecha_creacion = models.DateTimeField(auto_now_add=True, verbose_name="Fecha de Creaci√≥n")
    fecha_actualizacion = models.DateTimeField(auto_now=True, verbose_name="Fecha de Actualizaci√≥n")
    creado_por = models.ForeignKey(
        'Usuario', 
        on_delete=models.SET_NULL, 
        null=True, 
        blank=True,
        related_name='%(class)s_creados',
        verbose_name="Creado por"
    )
    actualizado_por = models.ForeignKey(
        'Usuario', 
        on_delete=models.SET_NULL, 
        null=True, 
        blank=True,
        related_name='%(class)s_actualizados',
        verbose_name="Actualizado por"
    )
    
    class Meta:
        abstract = True

class SoftDeleteModel(models.Model):
    """
    Modelo base para soft delete
    """
    eliminado = models.BooleanField(default=False, verbose_name="Eliminado")
    fecha_eliminacion = models.DateTimeField(blank=True, null=True, verbose_name="Fecha de Eliminaci√≥n")
    eliminado_por = models.ForeignKey(
        'Usuario', 
        on_delete=models.SET_NULL, 
        null=True, 
        blank=True,
        verbose_name="Eliminado por"
    )
    
    class Meta:
        abstract = True
    
    def delete(self, using=None, keep_parents=False):
        from django.utils import timezone
        self.eliminado = True
        self.fecha_eliminacion = timezone.now()
        self.save(using=using)
    
    def hard_delete(self, using=None, keep_parents=False):
        super().delete(using=using, keep_parents=keep_parents)
```

2. SISTEMA DE ROLES PARA USUARIOS (CORREGIDO):
==============================================

```python
# apps/core/models.py (continuaci√≥n)

class RolUsuario(models.Model):
    """
    Modelo para roles de usuarios del sistema
    """
    nombre = models.CharField(max_length=50, unique=True, verbose_name="Nombre del Rol")
    descripcion = models.TextField(verbose_name="Descripci√≥n")
    
    # Permisos espec√≠ficos
    puede_crear_empresas = models.BooleanField(default=False, verbose_name="Puede Crear Empresas")
    puede_editar_empresas = models.BooleanField(default=False, verbose_name="Puede Editar Empresas")
    puede_eliminar_empresas = models.BooleanField(default=False, verbose_name="Puede Eliminar Empresas")
    puede_ver_auditoria = models.BooleanField(default=False, verbose_name="Puede Ver Auditor√≠a")
    puede_exportar_datos = models.BooleanField(default=True, verbose_name="Puede Exportar Datos")
    puede_importar_datos = models.BooleanField(default=False, verbose_name="Puede Importar Datos")
    puede_gestionar_usuarios = models.BooleanField(default=False, verbose_name="Puede Gestionar Usuarios")
    puede_acceder_admin = models.BooleanField(default=False, verbose_name="Puede Acceder al Admin")
    
    # Nivel de acceso
    nivel_acceso = models.IntegerField(
        choices=[
            (1, 'Consulta'),
            (2, 'Analista'),
            (3, 'Administrador'),
        ],
        default=1,
        verbose_name="Nivel de Acceso"
    )
    
    activo = models.BooleanField(default=True, verbose_name="Activo")
    fecha_creacion = models.DateTimeField(auto_now_add=True, verbose_name="Fecha de Creaci√≥n")
    
    class Meta:
        db_table = 'rol_usuario'
        verbose_name = 'Rol de Usuario'
        verbose_name_plural = 'Roles de Usuario'
        ordering = ['nivel_acceso', 'nombre']
    
    def __str__(self):
        return f"{self.nombre} (Nivel {self.nivel_acceso})"

class UsuarioManager(BaseUserManager):
    def create_user(self, email, password=None, **extra_fields):
        if not email:
            raise ValueError('El email es obligatorio')
        email = self.normalize_email(email)
        user = self.model(email=email, **extra_fields)
        user.set_password(password)
        user.save(using=self._db)
        return user

    def create_superuser(self, email, password=None, **extra_fields):
        extra_fields.setdefault('is_staff', True)
        extra_fields.setdefault('is_superuser', True)
        return self.create_user(email, password, **extra_fields)

class Usuario(AbstractBaseUser, PermissionsMixin):
    """
    Modelo de usuario personalizado con sistema de roles
    """
    # Campos b√°sicos
    email = models.EmailField(unique=True, verbose_name="Email")
    nombre = models.CharField(max_length=50, verbose_name="Nombre")
    apellido = models.CharField(max_length=50, verbose_name="Apellido")
    
    # Sistema de roles
    rol = models.ForeignKey(
        RolUsuario, 
        on_delete=models.PROTECT, 
        verbose_name="Rol del Usuario",
        help_text="Rol que determina los permisos del usuario"
    )
    
    # Campos de estado
    is_active = models.BooleanField(default=True, verbose_name="Activo")
    is_staff = models.BooleanField(default=False, verbose_name="Es Staff")
    is_superuser = models.BooleanField(default=False, verbose_name="Es Superusuario")
    
    # Campos de fecha
    date_joined = models.DateTimeField(default=timezone.now, verbose_name="Fecha de Registro")
    last_login = models.DateTimeField(blank=True, null=True, verbose_name="√öltimo Acceso")
    
    # Campos adicionales
    telefono = models.CharField(
        max_length=20, 
        blank=True, 
        null=True, 
        verbose_name="Tel√©fono",
        validators=[RegexValidator(
            regex=r'^\+?1?\d{9,15}$',
            message="Formato de tel√©fono inv√°lido"
        )]
    )
    avatar = models.ImageField(
        upload_to='avatars/', 
        blank=True, 
        null=True, 
        verbose_name="Avatar"
    )
    
    # Campos adicionales importantes
    fecha_nacimiento = models.DateField(blank=True, null=True, verbose_name="Fecha de Nacimiento")
    genero = models.CharField(
        max_length=1,
        choices=[('M', 'Masculino'), ('F', 'Femenino'), ('O', 'Otro')],
        blank=True,
        null=True,
        verbose_name="G√©nero"
    )
    tipo_documento = models.CharField(
        max_length=10,
        choices=[('DNI', 'DNI'), ('PAS', 'Pasaporte'), ('LE', 'Libreta de Enrolamiento')],
        default='DNI',
        verbose_name="Tipo de Documento"
    )
    numero_documento = models.CharField(
        max_length=20,
        blank=True,
        null=True,
        verbose_name="N√∫mero de Documento"
    )
    fecha_ultimo_acceso = models.DateTimeField(blank=True, null=True, verbose_name="√öltimo Acceso")
    intentos_login_fallidos = models.PositiveIntegerField(default=0, verbose_name="Intentos de Login Fallidos")
    bloqueado_hasta = models.DateTimeField(blank=True, null=True, verbose_name="Bloqueado Hasta")
    
    # Ubicaci√≥n del usuario (compartida con empresas)
    departamento = models.CharField(
        max_length=100, 
        blank=True, 
        null=True, 
        verbose_name="Departamento"
    )
    municipio = models.CharField(
        max_length=100, 
        blank=True, 
        null=True, 
        verbose_name="Municipio"
    )
    localidad = models.CharField(
        max_length=100, 
        blank=True, 
        null=True, 
        verbose_name="Localidad"
    )
    
    objects = UsuarioManager()
    
    USERNAME_FIELD = 'email'
    REQUIRED_FIELDS = ['nombre', 'apellido', 'rol']
    
    class Meta:
        db_table = 'usuario'
        verbose_name = 'Usuario'
        verbose_name_plural = 'Usuarios'
        ordering = ['-date_joined']
    
    def __str__(self):
        return f"{self.nombre} {self.apellido} ({self.email}) - {self.rol.nombre}"
    
    def get_full_name(self):
        return f"{self.nombre} {self.apellido}"
    
    def get_short_name(self):
        return self.nombre
    
    def has_perm(self, perm, obj=None):
        """
        Verificar si el usuario tiene un permiso espec√≠fico
        """
        if self.is_superuser:
            return True
        
        # Verificar permisos basados en el rol
        if perm == 'empresas.add_empresaproducto':
            return self.rol.puede_crear_empresas
        elif perm == 'empresas.change_empresaproducto':
            return self.rol.puede_editar_empresas
        elif perm == 'empresas.delete_empresaproducto':
            return self.rol.puede_eliminar_empresas
        elif perm == 'auditoria.view_auditorialog':
            return self.rol.puede_ver_auditoria
        elif perm == 'empresas.export_data':
            return self.rol.puede_exportar_datos
        elif perm == 'empresas.import_data':
            return self.rol.puede_importar_datos
        elif perm == 'core.add_usuario':
            return self.rol.puede_gestionar_usuarios
        
        return super().has_perm(perm, obj)
```

2. MODELOS DE UBICACI√ìN (COMPARTIDOS):
======================================

```python
# apps/core/models.py (continuaci√≥n)

class Dpto(models.Model):
    """
    Modelo para departamentos/provincias (COMPARTIDO entre usuarios y empresas)
    """
    nombre = models.CharField(max_length=100, verbose_name="Nombre del Departamento")
    codigo = models.CharField(max_length=10, unique=True, verbose_name="C√≥digo")
    activo = models.BooleanField(default=True, verbose_name="Activo")
    
    class Meta:
        db_table = 'dpto'
        verbose_name = 'Departamento'
        verbose_name_plural = 'Departamentos'
        ordering = ['nombre']
    
    def __str__(self):
        return self.nombre

class Municipio(models.Model):
    """
    Modelo para municipios (COMPARTIDO entre usuarios y empresas)
    """
    nombre = models.CharField(max_length=100, verbose_name="Nombre del Municipio")
    dpto = models.ForeignKey(Dpto, on_delete=models.CASCADE, related_name='municipios')
    activo = models.BooleanField(default=True, verbose_name="Activo")
    
    class Meta:
        db_table = 'municipio'
        verbose_name = 'Municipio'
        verbose_name_plural = 'Municipios'
        ordering = ['nombre']
        unique_together = ['nombre', 'dpto']
    
    def __str__(self):
        return f"{self.nombre} - {self.dpto.nombre}"

class Localidades(models.Model):
    """
    Modelo para localidades (COMPARTIDO entre usuarios y empresas)
    """
    nombre = models.CharField(max_length=100, verbose_name="Nombre de la Localidad")
    municipio = models.ForeignKey(Municipio, on_delete=models.CASCADE, related_name='localidades')
    activo = models.BooleanField(default=True, verbose_name="Activo")
    
    class Meta:
        db_table = 'localidades'
        verbose_name = 'Localidad'
        verbose_name_plural = 'Localidades'
        ordering = ['nombre']
        unique_together = ['nombre', 'municipio']
    
    def __str__(self):
        return f"{self.nombre} - {self.municipio.nombre}"
```

3. MODELOS DE EMPRESAS (CORREGIDOS):
====================================

```python
# apps/empresas/models.py
from django.db import models
from django.core.validators import RegexValidator
from apps.core.models import Usuario, Dpto, Municipio, Localidades

class TipoEmpresa(models.Model):
    """
    Modelo para tipos de empresa
    """
    nombre = models.CharField(max_length=50, unique=True, verbose_name="Nombre del Tipo")
    descripcion = models.TextField(verbose_name="Descripci√≥n")
    activo = models.BooleanField(default=True, verbose_name="Activo")
    
    class Meta:
        db_table = 'tipo_empresa'
        verbose_name = 'Tipo de Empresa'
        verbose_name_plural = 'Tipos de Empresa'
        ordering = ['nombre']
    
    def __str__(self):
        return self.nombre

class Rubro(models.Model):
    """
    Modelo para rubros de empresas (PERTENECE A EMPRESAS)
    BASADO EN UNIDADES DE MEDIDA POR RUBRO.pdf
    """
    nombre = models.CharField(max_length=100, verbose_name="Nombre del Rubro")
    descripcion = models.TextField(blank=True, null=True, verbose_name="Descripci√≥n")
    tipo = models.CharField(
        max_length=20,
        choices=[
            ('producto', 'Producto'),
            ('servicio', 'Servicio'),
            ('mixto', 'Mixto'),
            ('otro', 'Otro'),
        ],
        default='producto',
        verbose_name="Tipo de Rubro"
    )
    
    # UNIDAD DE MEDIDA EST√ÅNDAR POR RUBRO (basado en PDF)
    unidad_medida_estandar = models.CharField(
        max_length=20,
        choices=[
            ('tn', 'Toneladas (tn)'),
            ('kg', 'Kilogramos (kg)'),
            ('lts', 'Litros (lts)'),
            ('u', 'Unidades (u)'),
            ('na', 'N/A (No aplica)'),
        ],
        default='kg',
        verbose_name="Unidad de Medida Est√°ndar",
        help_text="Unidad de medida est√°ndar para este rubro seg√∫n clasificaci√≥n oficial"
    )
    
    activo = models.BooleanField(default=True, verbose_name="Activo")
    orden = models.PositiveIntegerField(default=0, verbose_name="Orden de Visualizaci√≥n")
    
    class Meta:
        db_table = 'rubro'
        verbose_name = 'Rubro'
        verbose_name_plural = 'Rubros'
        ordering = ['orden', 'nombre']
    
    def __str__(self):
        return f"{self.nombre} ({self.get_tipo_display()})"

class UnidadMedida(models.Model):
    """
    Modelo para unidades de medida (PERTENECE A EMPRESAS)
    """
    nombre = models.CharField(max_length=50, verbose_name="Nombre de la Unidad")
    simbolo = models.CharField(max_length=10, verbose_name="S√≠mbolo")
    tipo = models.CharField(
        max_length=20,
        choices=[
            ('peso', 'Peso'),
            ('volumen', 'Volumen'),
            ('longitud', 'Longitud'),
            ('unidad', 'Unidad'),
            ('otro', 'Otro'),
        ],
        verbose_name="Tipo de Unidad"
    )
    activo = models.BooleanField(default=True, verbose_name="Activo")
    
    class Meta:
        db_table = 'unidad_medida'
        verbose_name = 'Unidad de Medida'
        verbose_name_plural = 'Unidades de Medida'
        ordering = ['tipo', 'nombre']
    
    def __str__(self):
        return f"{self.nombre} ({self.simbolo})"

class Otrorubro(models.Model):
    """
    Modelo para rubros adicionales (PERTENECE A EMPRESAS)
    """
    nombre = models.CharField(max_length=100, verbose_name="Nombre del Rubro")
    descripcion = models.TextField(blank=True, null=True, verbose_name="Descripci√≥n")
    activo = models.BooleanField(default=True, verbose_name="Activo")
    
    class Meta:
        db_table = 'otrorubro'
        verbose_name = 'Otro Rubro'
        verbose_name_plural = 'Otros Rubros'
        ordering = ['nombre']
    
    def __str__(self):
        return self.nombre

# Modelo base para empresas
class EmpresaBase(TimestampedModel):
    """
    Modelo base para todas las empresas (hereda de TimestampedModel)
    """
    # Campos b√°sicos obligatorios
    razon_social = models.CharField(max_length=150, verbose_name="Raz√≥n Social")
    cuit_cuil = models.CharField(
        unique=True, 
        max_length=11, 
        verbose_name="CUIT/CUIL",
        validators=[RegexValidator(
            regex=r'^\d{11}$',
            message="CUIT debe tener exactamente 11 d√≠gitos"
        )]
    )
    direccion = models.CharField(max_length=255, verbose_name="Direcci√≥n")
    
    # Ubicaci√≥n (usando modelos compartidos)
    departamento = models.ForeignKey(
        Dpto, 
        on_delete=models.PROTECT, 
        verbose_name="Departamento"
    )
    municipio = models.ForeignKey(
        Municipio, 
        on_delete=models.PROTECT, 
        blank=True, 
        null=True,
        verbose_name="Municipio"
    )
    localidad = models.ForeignKey(
        Localidades, 
        on_delete=models.PROTECT, 
        blank=True, 
        null=True,
        verbose_name="Localidad"
    )
    geolocalizacion = models.CharField(max_length=2083, blank=True, null=True, verbose_name="Geolocalizaci√≥n")
    
    # Campos de contacto b√°sicos
    telefono = models.CharField(
        max_length=20, 
        blank=True, 
        null=True, 
        verbose_name="Tel√©fono Principal",
        validators=[RegexValidator(
            regex=r'^\+?1?\d{9,15}$',
            message="Formato de tel√©fono inv√°lido"
        )]
    )
    correo = models.EmailField(max_length=254, blank=True, null=True, verbose_name="Correo Electr√≥nico Principal")
    sitioweb = models.URLField(max_length=200, blank=True, null=True, verbose_name="Sitio Web")
    
    # SISTEMA DE EMAILS SIMPLIFICADO - MEJOR UX
    email_secundario = models.EmailField(
        max_length=254, 
        blank=True, 
        null=True, 
        verbose_name="Email Secundario",
        help_text="Email adicional de la empresa (opcional)"
    )
    email_terciario = models.EmailField(
        max_length=254, 
        blank=True, 
        null=True, 
        verbose_name="Email Terciario",
        help_text="Tercer email de la empresa (opcional)"
    )
    
    # SISTEMA DE CONTACTOS SIMPLIFICADO - MEJOR UX
    contacto_principal_nombre = models.CharField(
        max_length=100,
        verbose_name="Nombre del Contacto Principal",
        help_text="Nombre del contacto principal de la empresa (OBLIGATORIO)"
    )
    contacto_principal_cargo = models.CharField(
        max_length=100,
        verbose_name="Cargo del Contacto Principal",
        help_text="Cargo del contacto principal (OBLIGATORIO)"
    )
    contacto_principal_telefono = models.CharField(
        max_length=20,
        verbose_name="Tel√©fono del Contacto Principal",
        help_text="Tel√©fono del contacto principal (OBLIGATORIO)",
        validators=[RegexValidator(
            regex=r'^\+?1?\d{9,15}$',
            message="Formato de tel√©fono inv√°lido"
        )]
    )
    contacto_principal_email = models.EmailField(
        max_length=254,
        verbose_name="Email del Contacto Principal",
        help_text="Email del contacto principal (OBLIGATORIO)"
    )
    
    # Contacto secundario (opcional)
    contacto_secundario_nombre = models.CharField(
        max_length=100, 
        blank=True, 
        null=True, 
        verbose_name="Nombre del Contacto Secundario"
    )
    contacto_secundario_cargo = models.CharField(
        max_length=100, 
        blank=True, 
        null=True, 
        verbose_name="Cargo del Contacto Secundario"
    )
    contacto_secundario_telefono = models.CharField(
        max_length=20, 
        blank=True, 
        null=True, 
        verbose_name="Tel√©fono del Contacto Secundario",
        validators=[RegexValidator(
            regex=r'^\+?1?\d{9,15}$',
            message="Formato de tel√©fono inv√°lido"
        )]
    )
    contacto_secundario_email = models.EmailField(
        max_length=254, 
        blank=True, 
        null=True, 
        verbose_name="Email del Contacto Secundario"
    )
    
    # Campos de exportaci√≥n (opcionales) - SISTEMA SIMPLIFICADO OPTIMIZADO
    exporta = models.CharField(
        max_length=50,
        choices=[
            ("S√≠", "S√≠"),
            ("No, solo ventas nacionales", "No, solo ventas nacionales"),
            ("No, solo ventas locales", "No, solo ventas locales"),
        ],
        blank=True,
        null=True,
        verbose_name="¬øLa Empresa Exporta?",
        help_text="Seleccione el tipo de ventas que realiza la empresa"
    )
    destinoexporta = models.CharField(
        max_length=200, 
        blank=True, 
        null=True, 
        verbose_name="Destinos de Exportaci√≥n",
        help_text="Si exporta, indique los destinos. Si son varios, sep√°relos por comas."
    )
    tipoexporta = models.CharField(
        max_length=50, 
        blank=True, 
        null=True, 
        verbose_name="Tipo de Exportaci√≥n",
        choices=[
            ('Directa', 'Directa'),
            ('Terceros', 'A trav√©s de Terceros'),
            ('Mixta', 'Mixta'),
        ]
    )
    interes_exportar = models.BooleanField(
        null=True, 
        blank=True, 
        verbose_name="¬øEst√° Interesada en Comenzar a Exportar?",
        help_text="Marque si la empresa est√° interesada en comenzar a exportar"
    )
    
    # Campos de importaci√≥n (opcionales) - SISTEMA SIMPLIFICADO OPTIMIZADO
    importa = models.BooleanField(
        null=True, 
        blank=True, 
        verbose_name="¬øLa Empresa Realiza Importaciones?",
        help_text="Marque si la empresa realiza importaciones"
    )
    tipoimporta = models.CharField(
        max_length=200, 
        blank=True, 
        null=True, 
        verbose_name="Tipos de Importaci√≥n",
        help_text="Si importa, indique los tipos. Si son varios, sep√°relos por comas."
    )
    otrasimportaciones = models.CharField(
        max_length=200, 
        blank=True, 
        null=True, 
        verbose_name="Otras Importaciones",
        help_text="Si seleccion√≥ 'Otros' en tipos de importaci√≥n, detalle cu√°les"
    )
    frecuenciaimporta = models.CharField(
        max_length=50, 
        blank=True, 
        null=True, 
        verbose_name="Frecuencia de Importaci√≥n",
        choices=[
            ('Mensual', 'Mensual'),
            ('Anual', 'Anual'),
            ('Ocasional', 'De manera ocasional'),
            ('Nunca', 'Nunca realic√© importaciones'),
        ]
    )
    
    # Campos de certificaciones (opcionales) - SISTEMA SIMPLIFICADO CON ARCHIVOS
    certificadopyme = models.BooleanField(
        null=True, 
        blank=True, 
        verbose_name="¬øPosee Certificado MiPYME?",
        help_text="Marque si la empresa posee certificado MiPYME"
    )
    certificacionesbool = models.BooleanField(
        null=True, 
        blank=True, 
        verbose_name="¬øPosee Certificaciones Internacionales?",
        help_text="Marque si la empresa posee certificaciones internacionales"
    )
    certificaciones = models.CharField(
        max_length=300, 
        blank=True, 
        null=True, 
        verbose_name="Detalle de Certificaciones",
        help_text="Si posee certificaciones, detalle cu√°les. Si son varias, sep√°relas por comas."
    )
    certificaciones_otros = models.CharField(
        max_length=300, 
        blank=True, 
        null=True, 
        verbose_name="Otras Certificaciones",
        help_text="Si seleccion√≥ 'Otra' en certificaciones, detalle cu√°les"
    )
    
    # Archivos de certificaciones - OPTIMIZADO PARA M√âTRICAS
    archivo_certificaciones = models.FileField(
        upload_to='certificaciones/%Y/%m/',
        blank=True,
        null=True,
        verbose_name="Archivo de Certificaciones",
        help_text="Subir archivo PDF o imagen de las certificaciones"
    )
    archivo_certificaciones_nombre = models.CharField(
        max_length=255,
        blank=True,
        null=True,
        verbose_name="Nombre del Archivo de Certificaciones"
    )
    
    # Campos de promoci√≥n (opcionales) - SISTEMA SIMPLIFICADO
    promo2idiomas = models.BooleanField(
        null=True, 
        blank=True, 
        verbose_name="¬øPosee Material de Promoci√≥n en M√°s de un Idioma?",
        help_text="Marque si la empresa posee material de promoci√≥n en m√°s de un idioma"
    )
    idiomas_trabaja = models.CharField(
        max_length=100, 
        blank=True, 
        null=True, 
        verbose_name="Idiomas con los que Trabaja",
        help_text="Si posee material en m√°s de un idioma, indique cu√°les. Si son varios, sep√°relos por comas."
    )
    
    # Campos de capacidad productiva - OPTIMIZADOS PARA M√âTRICAS
    capacidadproductiva = models.DecimalField(
        max_digits=10, 
        decimal_places=2, 
        null=True, 
        blank=True,
        verbose_name="Capacidad Productiva",
        help_text="Capacidad productiva de la empresa"
    )
    tiempocapacidad = models.CharField(
        max_length=20,
        choices=[
            ('Mensual', 'Mensual'),
            ('Anual', 'Anual'),
            ('Semanal', 'Semanal'),
        ],
        blank=True,
        null=True,
        verbose_name="Per√≠odo de la Capacidad Productiva"
    )
    otracapacidad = models.TextField(
        blank=True, 
        null=True, 
        verbose_name="Otra Capacidad Productiva",
        help_text="Si posee otro producto con diferente capacidad productiva, ind√≠quelo aqu√≠"
    )
    
    # Campos de redes sociales y web
    redes_sociales = models.TextField(
        blank=True, 
        null=True, 
        verbose_name="Redes Sociales",
        help_text="URLs o texto separado por comas"
    )
    
    # Campos de geolocalizaci√≥n con coordenadas
    latitud = models.DecimalField(
        max_digits=10, 
        decimal_places=8, 
        null=True, 
        blank=True,
        verbose_name="Latitud",
        help_text="Coordenada de latitud (se llena autom√°ticamente al seleccionar en el mapa)"
    )
    longitud = models.DecimalField(
        max_digits=11, 
        decimal_places=8, 
        null=True, 
        blank=True,
        verbose_name="Longitud",
        help_text="Coordenada de longitud (se llena autom√°ticamente al seleccionar en el mapa)"
    )
    
    # SISTEMA DE FERIAS SIMPLIFICADO - MEJOR UX
    participoferianacional = models.BooleanField(
        null=True, 
        blank=True, 
        verbose_name="¬øParticip√≥ en Ferias Nacionales?",
        help_text="Marque si la empresa particip√≥ en ferias nacionales"
    )
    feriasnacionales = models.TextField(
        blank=True, 
        null=True, 
        verbose_name="Detalle de Ferias Nacionales",
        help_text="Si particip√≥, detalle nombre, lugar y a√±o. Si son varias, sep√°relas por comas."
    )
    participoferiainternacional = models.BooleanField(
        null=True, 
        blank=True, 
        verbose_name="¬øParticip√≥ en Ferias Internacionales?",
        help_text="Marque si la empresa particip√≥ en ferias internacionales"
    )
    feriasinternacionales = models.TextField(
        blank=True, 
        null=True, 
        verbose_name="Detalle de Ferias Internacionales",
        help_text="Si particip√≥, detalle nombre, lugar y a√±o. Si son varias, sep√°relas por comas."
    )
    
    # Archivos de ferias - OPTIMIZADO PARA M√âTRICAS
    archivo_ferias = models.FileField(
        upload_to='ferias/%Y/%m/',
        blank=True,
        null=True,
        verbose_name="Archivo de Ferias",
        help_text="Subir archivo PDF o imagen de participaci√≥n en ferias"
    )
    archivo_ferias_nombre = models.CharField(
        max_length=255,
        blank=True,
        null=True,
        verbose_name="Nombre del Archivo de Ferias"
    )
    
    # Campos adicionales - OPTIMIZADOS PARA M√âTRICAS
    observaciones = models.CharField(max_length=1000, blank=True, null=True, verbose_name="Observaciones")
    puntaje = models.IntegerField(null=True, blank=True, verbose_name="Puntaje")
    
    # Campos de archivos adicionales
    logo = models.ImageField(
        upload_to='logos/%Y/%m/',
        blank=True,
        null=True,
        verbose_name="Logo de la Empresa"
    )
    brochure = models.FileField(
        upload_to='brochures/%Y/%m/',
        blank=True,
        null=True,
        verbose_name="Brochure o Cat√°logo",
        help_text="Subir archivo PDF o imagen del brochure/cat√°logo"
    )
    descripcion = models.TextField(
        blank=True, 
        null=True, 
        verbose_name="Descripci√≥n de la Empresa",
        help_text="Describa brevemente los productos/servicios de la empresa"
    )
    
    # Relaciones
    id_usuario = models.ForeignKey(Usuario, on_delete=models.CASCADE, verbose_name="Usuario")
    id_rubro = models.ForeignKey(Rubro, on_delete=models.PROTECT, verbose_name="Rubro")
    tipo_empresa = models.ForeignKey(TipoEmpresa, on_delete=models.PROTECT, verbose_name="Tipo de Empresa")
    
    class Meta:
        abstract = True
        indexes = [
            models.Index(fields=['razon_social']),
            models.Index(fields=['cuit_cuil']),
            models.Index(fields=['departamento', 'municipio']),
            models.Index(fields=['fecha_creacion']),
            models.Index(fields=['exporta', 'importa']),
            # √çndices optimizados para m√©tricas y filtros
            models.Index(fields=['exporta']),
            models.Index(fields=['importa']),
            models.Index(fields=['certificadopyme']),
            models.Index(fields=['certificacionesbool']),
            models.Index(fields=['participoferianacional']),
            models.Index(fields=['participoferiainternacional']),
            models.Index(fields=['promo2idiomas']),
            models.Index(fields=['capacidadproductiva']),
            models.Index(fields=['tiempocapacidad']),
            models.Index(fields=['puntaje']),
            models.Index(fields=['latitud', 'longitud']),
            models.Index(fields=['tipo_empresa']),
            models.Index(fields=['id_rubro']),
        ]
    
    def __str__(self):
        return self.razon_social

class Empresaproducto(EmpresaBase):
    """
    Modelo para empresas que SOLO ofrecen productos
    """
    class Meta:
        db_table = 'empresaproducto'
        verbose_name = 'Empresa de Producto'
        verbose_name_plural = 'Empresas de Productos'
        ordering = ['-fecha_creacion']

class Empresaservicio(EmpresaBase):
    """
    Modelo para empresas que SOLO ofrecen servicios
    """
    class Meta:
        db_table = 'empresaservicio'
        verbose_name = 'Empresa de Servicio'
        verbose_name_plural = 'Empresas de Servicios'
        ordering = ['-fecha_creacion']

class EmpresaMixta(EmpresaBase):
    """
    Modelo para empresas que ofrecen TANTO productos como servicios
    """
    class Meta:
        db_table = 'empresa_mixta'
        verbose_name = 'Empresa Mixta'
        verbose_name_plural = 'Empresas Mixtas'
        ordering = ['-fecha_creacion']

# MATRIZ DE CLASIFICACI√ìN DE PERFIL EXPORTADOR
class MatrizClasificacionExportador(models.Model):
    """
    Modelo para la matriz de clasificaci√≥n de perfil exportador
    BASADO EN MATRIZ DE CLASIFICACI√ìN DE PERFIL EXPORTADOR.pdf
    """
    empresa = models.ForeignKey(
        'EmpresaBase',
        on_delete=models.CASCADE,
        related_name='clasificaciones_exportador',
        verbose_name="Empresa"
    )
    
    # CRITERIOS DE EVALUACI√ìN (9 criterios, 0-3 puntos cada uno)
    experiencia_exportadora = models.IntegerField(
        choices=[(0, '0 puntos'), (1, '1 punto'), (2, '2 puntos'), (3, '3 puntos')],
        default=0,
        verbose_name="Experiencia Exportadora"
    )
    volumen_produccion = models.IntegerField(
        choices=[(0, '0 puntos'), (1, '1 punto'), (2, '2 puntos'), (3, '3 puntos')],
        default=0,
        verbose_name="Volumen de Producci√≥n"
    )
    presencia_digital = models.IntegerField(
        choices=[(0, '0 puntos'), (1, '1 punto'), (2, '2 puntos'), (3, '3 puntos')],
        default=0,
        verbose_name="Presencia Digital"
    )
    posicion_arancelaria = models.IntegerField(
        choices=[(0, '0 puntos'), (1, '1 punto'), (2, '2 puntos'), (3, '3 puntos')],
        default=0,
        verbose_name="Posici√≥n Arancelaria"
    )
    participacion_internacionalizacion = models.IntegerField(
        choices=[(0, '0 puntos'), (1, '1 punto'), (2, '2 puntos'), (3, '3 puntos')],
        default=0,
        verbose_name="Participaci√≥n en Internacionalizaci√≥n"
    )
    estructura_interna = models.IntegerField(
        choices=[(0, '0 puntos'), (1, '1 punto'), (2, '2 puntos'), (3, '3 puntos')],
        default=0,
        verbose_name="Estructura Interna"
    )
    interes_exportador = models.IntegerField(
        choices=[(0, '0 puntos'), (1, '1 punto'), (2, '2 puntos'), (3, '3 puntos')],
        default=0,
        verbose_name="Inter√©s Exportador"
    )
    certificaciones_nacionales = models.IntegerField(
        choices=[(0, '0 puntos'), (1, '1 punto'), (2, '2 puntos'), (3, '3 puntos')],
        default=0,
        verbose_name="Certificaciones Nacionales"
    )
    certificaciones_internacionales = models.IntegerField(
        choices=[(0, '0 puntos'), (1, '1 punto'), (2, '2 puntos'), (3, '3 puntos')],
        default=0,
        verbose_name="Certificaciones Internacionales"
    )
    
    # PUNTAJE TOTAL Y CATEGOR√çA
    puntaje_total = models.IntegerField(
        default=0,
        verbose_name="Puntaje Total",
        help_text="Suma de todos los criterios (m√°ximo 18 puntos)"
    )
    categoria = models.CharField(
        max_length=30,
        choices=[
            ('exportadora', 'Exportadora (12-18 puntos)'),
            ('potencial_exportadora', 'Potencial Exportadora (6-11 puntos)'),
            ('etapa_inicial', 'Etapa Inicial (0-5 puntos)'),
        ],
        default='etapa_inicial',
        verbose_name="Categor√≠a de Clasificaci√≥n"
    )
    
    # FECHA DE EVALUACI√ìN
    fecha_evaluacion = models.DateTimeField(
        auto_now_add=True,
        verbose_name="Fecha de Evaluaci√≥n"
    )
    evaluado_por = models.ForeignKey(
        Usuario,
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        verbose_name="Evaluado por"
    )
    
    # OBSERVACIONES
    observaciones = models.TextField(
        blank=True,
        null=True,
        verbose_name="Observaciones",
        help_text="Comentarios adicionales sobre la evaluaci√≥n"
    )
    
    class Meta:
        db_table = 'matriz_clasificacion_exportador'
        verbose_name = 'Matriz de Clasificaci√≥n Exportador'
        verbose_name_plural = 'Matrices de Clasificaci√≥n Exportador'
        ordering = ['-fecha_evaluacion']
        unique_together = ['empresa', 'fecha_evaluacion']
    
    def save(self, *args, **kwargs):
        # Calcular puntaje total autom√°ticamente
        self.puntaje_total = (
            self.experiencia_exportadora +
            self.volumen_produccion +
            self.presencia_digital +
            self.posicion_arancelaria +
            self.participacion_internacionalizacion +
            self.estructura_interna +
            self.interes_exportador +
            self.certificaciones_nacionales +
            self.certificaciones_internacionales
        )
        
        # Determinar categor√≠a basada en el puntaje
        if self.puntaje_total >= 12:
            self.categoria = 'exportadora'
        elif self.puntaje_total >= 6:
            self.categoria = 'potencial_exportadora'
        else:
            self.categoria = 'etapa_inicial'
        
        super().save(*args, **kwargs)
    
    def __str__(self):
        return f"{self.empresa.razon_social} - {self.get_categoria_display()} ({self.puntaje_total}/18 pts)"
```

4. MODELOS RELACIONADOS (CONTINUACI√ìN):
=======================================

```python
# apps/empresas/models.py (continuaci√≥n)

class ProductoEmpresa(models.Model):
    """
    Modelo para productos espec√≠ficos de cada empresa
    """
    empresa = models.ForeignKey(
        Empresaproducto, 
        on_delete=models.CASCADE, 
        related_name='productos',
        verbose_name="Empresa"
    )
    nombre_producto = models.CharField(
        max_length=200, 
        verbose_name="Nombre del Producto"
    )
    descripcion = models.TextField(
        verbose_name="Descripci√≥n del Producto"
    )
    
    # CAPACIDAD PRODUCTIVA POR PRODUCTO (no por empresa)
    capacidad_productiva = models.DecimalField(
        max_digits=10, 
        decimal_places=2, 
        null=True, 
        blank=True,
        verbose_name="Capacidad Productiva",
        help_text="Capacidad productiva de ESTE producto espec√≠fico"
    )
    unidad_medida = models.CharField(
        max_length=20,
        choices=[
            ('kg', 'Kilogramos'),
            ('tn', 'Toneladas'),
            ('lt', 'Litros'),
            ('m3', 'Metros c√∫bicos'),
            ('un', 'Unidades'),
            ('otro', 'Otro'),
        ],
        default='kg',
        verbose_name="Unidad de Medida",
        help_text="Unidad de medida para ESTE producto espec√≠fico"
    )
    periodo_capacidad = models.CharField(
        max_length=20,
        choices=[
            ('mensual', 'Mensual'),
            ('anual', 'Anual'),
            ('semanal', 'Semanal'),
        ],
        default='mensual',
        verbose_name="Per√≠odo de Capacidad",
        help_text="Per√≠odo de capacidad para ESTE producto espec√≠fico"
    )
    
    # OPCIONAL: Marcar un producto como principal (no obligatorio)
    es_principal = models.BooleanField(
        default=False, 
        verbose_name="Producto Principal",
        help_text="Marcar si este es el producto principal de la empresa"
    )
    
    # Campos adicionales por producto
    precio_estimado = models.DecimalField(
        max_digits=10, 
        decimal_places=2, 
        null=True, 
        blank=True,
        verbose_name="Precio Estimado",
        help_text="Precio estimado por unidad"
    )
    moneda_precio = models.CharField(
        max_length=3,
        choices=[
            ('ARS', 'Pesos Argentinos'),
            ('USD', 'D√≥lares'),
            ('EUR', 'Euros'),
        ],
        default='ARS',
        verbose_name="Moneda del Precio"
    )
    
    # Campos de auditor√≠a (heredados de TimestampedModel)
    
    class Meta:
        db_table = 'producto_empresa'
        verbose_name = 'Producto de Empresa'
        verbose_name_plural = 'Productos de Empresa'
        ordering = ['-es_principal', 'nombre_producto']
    
    def __str__(self):
        return f"{self.nombre_producto} - {self.empresa.razon_social}"

class ServicioEmpresa(models.Model):
    """
    Modelo para servicios espec√≠ficos de cada empresa
    BASADO EN FORMULARIO SERVICIOS - CAMPOS COMPLETOS
    """
    empresa = models.ForeignKey(
        Empresaservicio, 
        on_delete=models.CASCADE, 
        related_name='servicios',
        verbose_name="Empresa"
    )
    nombre_servicio = models.CharField(
        max_length=200, 
        verbose_name="Nombre del Servicio"
    )
    descripcion = models.TextField(
        verbose_name="Descripci√≥n del Servicio"
    )
    
    # TIPO DE SERVICIO (basado en formulario)
    tipo_servicio = models.CharField(
        max_length=50,
        choices=[
            ('consultoria', 'Consultor√≠a y servicios empresariales'),
            ('tecnologias', 'Tecnolog√≠as de la informaci√≥n (IT)'),
            ('diseno_marketing', 'Dise√±o y marketing'),
            ('capacitacion', 'Capacitaci√≥n y educaci√≥n online'),
            ('culturales_eventos', 'Servicios culturales y eventos'),
            ('investigacion_desarrollo', 'Investigaci√≥n y desarrollo (I+D)'),
            ('turismo_receptivo', 'Turismo receptivo'),
            ('otro', 'Otro (especificar)'),
        ],
        verbose_name="Tipo de Servicio"
    )
    tipo_servicio_otro = models.CharField(
        max_length=200,
        blank=True,
        null=True,
        verbose_name="Especificar Otro Tipo de Servicio"
    )
    
    # SECTORES A LOS QUE PRESTA SERVICIOS
    sector_atendido = models.CharField(
        max_length=50,
        choices=[
            ('mineria', 'Miner√≠a'),
            ('agroindustria', 'Agroindustria'),
            ('turismo', 'Turismo'),
            ('comercio', 'Comercio'),
            ('salud', 'Salud'),
            ('pymes', 'Pymes'),
            ('otro', 'Otro'),
        ],
        verbose_name="Sector Atendido"
    )
    sector_otro = models.CharField(
        max_length=200,
        blank=True,
        null=True,
        verbose_name="Especificar Otro Sector"
    )
    
    # ALCANCE GEOGR√ÅFICO
    alcance_servicio = models.CharField(
        max_length=20,
        choices=[
            ('local', 'Local'),
            ('nacional', 'Nacional'),
            ('internacional', 'Internacional'),
        ],
        verbose_name="Alcance del Servicio"
    )
    paises_trabaja = models.CharField(
        max_length=500,
        blank=True,
        null=True,
        verbose_name="Pa√≠ses con los que Trabaja",
        help_text="Si aplica, listar pa√≠ses separados por comas"
    )
    
    # EXPORTACI√ìN DE SERVICIOS
    exporta_servicios = models.BooleanField(
        null=True,
        blank=True,
        verbose_name="¬øExporta Servicios?",
        help_text="Marque si la empresa exporta servicios"
    )
    interes_exportar_servicios = models.BooleanField(
        null=True,
        blank=True,
        verbose_name="¬øInter√©s en Exportar Servicios?",
        help_text="Marque si tiene inter√©s en exportar servicios"
    )
    
    # IDIOMAS DE TRABAJO
    idiomas_trabajo = models.CharField(
        max_length=200,
        blank=True,
        null=True,
        verbose_name="Idiomas con los que Trabaja",
        help_text="Espa√±ol, Ingl√©s, Portugu√©s, Otro (especificar)"
    )
    idioma_otro = models.CharField(
        max_length=200,
        blank=True,
        null=True,
        verbose_name="Especificar Otro Idioma"
    )
    
    # FORMA DE CONTRATACI√ìN
    forma_contratacion = models.CharField(
        max_length=20,
        choices=[
            ('hora', 'Por Hora'),
            ('proyecto', 'Por Proyecto'),
            ('mensual', 'Mensual'),
            ('otro', 'Otro'),
        ],
        verbose_name="Forma de Contrataci√≥n"
    )
    forma_contratacion_otro = models.CharField(
        max_length=200,
        blank=True,
        null=True,
        verbose_name="Especificar Otra Forma de Contrataci√≥n"
    )
    
    # CERTIFICACIONES T√âCNICAS
    certificaciones_tecnicas = models.CharField(
        max_length=500,
        blank=True,
        null=True,
        verbose_name="Certificaciones T√©cnicas",
        help_text="ISO 9001, ISO 14001, SCRUM, AWS, etc. Separar por comas"
    )
    tiene_equipo_tecnico = models.BooleanField(
        null=True,
        blank=True,
        verbose_name="¬øTiene Equipo T√©cnico Especializado?",
        help_text="Marque si tiene equipo t√©cnico especializado"
    )
    equipo_tecnico_formacion = models.BooleanField(
        null=True,
        blank=True,
        verbose_name="¬øEquipo en Formaci√≥n?",
        help_text="Marque si el equipo est√° en formaci√≥n"
    )
    
    es_principal = models.BooleanField(
        default=False, 
        verbose_name="Servicio Principal",
        help_text="Marcar si este es el servicio principal de la empresa"
    )
    
    # Campos de auditor√≠a (heredados de TimestampedModel)
    
    class Meta:
        db_table = 'servicio_empresa'
        verbose_name = 'Servicio de Empresa'
        verbose_name_plural = 'Servicios de Empresa'
        ordering = ['-es_principal', 'nombre_servicio']
    
    def __str__(self):
        return f"{self.nombre_servicio} - {self.empresa.razon_social}"

class PosicionArancelaria(models.Model):
    """
    Modelo para posiciones arancelarias de productos (UNIVERSALES - Sistema Armonizado SA)
    """
    producto = models.ForeignKey(
        ProductoEmpresa, 
        on_delete=models.CASCADE, 
        related_name='posicion_arancelaria',  # ‚Üê UNA posici√≥n por producto
        verbose_name="Producto"
    )
    codigo_arancelario = models.CharField(
        max_length=20,
        verbose_name="C√≥digo Arancelario",
        help_text="Formato: 1234.56.78 - UNIVERSAL (Sistema Armonizado SA)"
    )
    descripcion_arancelaria = models.CharField(
        max_length=300,
        blank=True,
        null=True,
        verbose_name="Descripci√≥n Arancelaria"
    )
    
    # Campos de auditor√≠a (heredados de TimestampedModel)
    
    class Meta:
        db_table = 'posicion_arancelaria'
        verbose_name = 'Posici√≥n Arancelaria'
        verbose_name_plural = 'Posiciones Arancelarias'
        ordering = ['codigo_arancelario']
        # Constraint para asegurar UNA posici√≥n por producto
        constraints = [
            models.UniqueConstraint(
                fields=['producto'],
                name='unique_position_per_product'
            )
        ]
    
    def __str__(self):
        return f"{self.codigo_arancelario} - {self.producto.nombre_producto}"
    
    def clean(self):
        super().clean()
        # Validar formato del c√≥digo arancelario
        import re
        if not re.match(r'^\d{4}\.\d{2}\.\d{2}$', self.codigo_arancelario):
            raise ValidationError('El c√≥digo arancelario debe tener el formato 1234.56.78')
```

5. MODELOS DE CONTACTOS Y EMAILS OPTIMIZADOS:
==============================================

```python
# apps/empresas/models.py (continuaci√≥n)

# SISTEMA DE CONTACTOS SIMPLIFICADO - MEJOR UX
# =============================================
# En lugar de un modelo separado complejo, usamos campos simples en EmpresaBase
# que son m√°s f√°ciles de llenar para el usuario

# Campos agregados a EmpresaBase:
# - contacto_principal_nombre (CharField)
# - contacto_principal_cargo (CharField) 
# - contacto_principal_telefono (CharField)
# - contacto_principal_email (EmailField)
# - contacto_secundario_nombre (CharField, opcional)
# - contacto_secundario_cargo (CharField, opcional)
# - contacto_secundario_telefono (CharField, opcional)
# - contacto_secundario_email (EmailField, opcional)

# VENTAJAS:
# ‚úÖ UX m√°s simple: Campos directos en el formulario principal
# ‚úÖ Menos clics: No necesita crear registros separados
# ‚úÖ Formulario √∫nico: Todo en una sola pantalla
# ‚úÖ Validaci√≥n simple: Campos opcionales claros

# SISTEMA DE EMAILS SIMPLIFICADO - MEJOR UX
# ==========================================
# En lugar de un modelo separado complejo, usamos campos simples en EmpresaBase
# que son m√°s f√°ciles de llenar para el usuario

# Campos agregados a EmpresaBase:
# - email_secundario (EmailField, opcional)
# - email_terciario (EmailField, opcional)

# VENTAJAS:
# ‚úÖ UX m√°s simple: Campos directos en el formulario principal
# ‚úÖ Menos clics: No necesita crear registros separados
# ‚úÖ Formulario √∫nico: Todo en una sola pantalla
# ‚úÖ Validaci√≥n simple: Campos opcionales claros

# SISTEMA DE FERIAS SIMPLIFICADO - MEJOR UX
# ===========================================
# En lugar de un modelo separado complejo, usamos campos simples en EmpresaBase
# que son m√°s f√°ciles de llenar para el usuario

# Campos agregados a EmpresaBase:
# - participoferianacional (BooleanField)
# - feriasnacionales (TextField) 
# - participoferiainternacional (BooleanField)
# - feriasinternacionales (TextField)

# VENTAJAS:
# ‚úÖ UX m√°s simple: Pregunta SI/NO, luego detalles
# ‚úÖ Validaci√≥n inteligente: Solo pide detalles si dice S√ç
# ‚úÖ Texto libre: Puede escribir cualquier feria
# ‚úÖ M√∫ltiples ferias: Separadas por comas
# ‚úÖ Sin restricciones: No limitado a opciones predefinidas
```

6. MODELOS DE EMPRESAS MIXTAS:
==============================

```python
# apps/empresas/models.py (continuaci√≥n)

class ProductoEmpresaMixta(models.Model):
    """
    Modelo para productos de empresas mixtas
    """
    empresa = models.ForeignKey(
        EmpresaMixta, 
        on_delete=models.CASCADE, 
        related_name='productos',
        verbose_name="Empresa Mixta"
    )
    nombre_producto = models.CharField(
        max_length=200, 
        verbose_name="Nombre del Producto"
    )
    descripcion = models.TextField(
        verbose_name="Descripci√≥n del Producto"
    )
    
    # CAPACIDAD PRODUCTIVA POR PRODUCTO
    capacidad_productiva = models.DecimalField(
        max_digits=10, 
        decimal_places=2, 
        null=True, 
        blank=True,
        verbose_name="Capacidad Productiva"
    )
    unidad_medida = models.CharField(
        max_length=20,
        choices=[
            ('kg', 'Kilogramos'),
            ('tn', 'Toneladas'),
            ('lt', 'Litros'),
            ('m3', 'Metros c√∫bicos'),
            ('un', 'Unidades'),
            ('otro', 'Otro'),
        ],
        default='kg',
        verbose_name="Unidad de Medida"
    )
    periodo_capacidad = models.CharField(
        max_length=20,
        choices=[
            ('mensual', 'Mensual'),
            ('anual', 'Anual'),
            ('semanal', 'Semanal'),
        ],
        default='mensual',
        verbose_name="Per√≠odo de Capacidad"
    )
    
    es_principal = models.BooleanField(
        default=False, 
        verbose_name="Producto Principal"
    )
    
    precio_estimado = models.DecimalField(
        max_digits=10, 
        decimal_places=2, 
        null=True, 
        blank=True,
        verbose_name="Precio Estimado"
    )
    moneda_precio = models.CharField(
        max_length=3,
        choices=[
            ('ARS', 'Pesos Argentinos'),
            ('USD', 'D√≥lares'),
            ('EUR', 'Euros'),
        ],
        default='ARS',
        verbose_name="Moneda del Precio"
    )
    
    # Campos de auditor√≠a (heredados de TimestampedModel)
    
    class Meta:
        db_table = 'producto_empresa_mixta'
        verbose_name = 'Producto de Empresa Mixta'
        verbose_name_plural = 'Productos de Empresas Mixtas'
        ordering = ['-es_principal', 'nombre_producto']
    
    def __str__(self):
        return f"{self.nombre_producto} - {self.empresa.razon_social}"

class ServicioEmpresaMixta(models.Model):
    """
    Modelo para servicios de empresas mixtas
    BASADO EN FORMULARIO SERVICIOS - CAMPOS COMPLETOS
    """
    empresa = models.ForeignKey(
        EmpresaMixta, 
        on_delete=models.CASCADE, 
        related_name='servicios',
        verbose_name="Empresa Mixta"
    )
    nombre_servicio = models.CharField(
        max_length=200, 
        verbose_name="Nombre del Servicio"
    )
    descripcion = models.TextField(
        verbose_name="Descripci√≥n del Servicio"
    )
    
    # TIPO DE SERVICIO (basado en formulario)
    tipo_servicio = models.CharField(
        max_length=50,
        choices=[
            ('consultoria', 'Consultor√≠a y servicios empresariales'),
            ('tecnologias', 'Tecnolog√≠as de la informaci√≥n (IT)'),
            ('diseno_marketing', 'Dise√±o y marketing'),
            ('capacitacion', 'Capacitaci√≥n y educaci√≥n online'),
            ('culturales_eventos', 'Servicios culturales y eventos'),
            ('investigacion_desarrollo', 'Investigaci√≥n y desarrollo (I+D)'),
            ('turismo_receptivo', 'Turismo receptivo'),
            ('otro', 'Otro (especificar)'),
        ],
        verbose_name="Tipo de Servicio"
    )
    tipo_servicio_otro = models.CharField(
        max_length=200,
        blank=True,
        null=True,
        verbose_name="Especificar Otro Tipo de Servicio"
    )
    
    # SECTORES A LOS QUE PRESTA SERVICIOS
    sector_atendido = models.CharField(
        max_length=50,
        choices=[
            ('mineria', 'Miner√≠a'),
            ('agroindustria', 'Agroindustria'),
            ('turismo', 'Turismo'),
            ('comercio', 'Comercio'),
            ('salud', 'Salud'),
            ('pymes', 'Pymes'),
            ('otro', 'Otro'),
        ],
        verbose_name="Sector Atendido"
    )
    sector_otro = models.CharField(
        max_length=200,
        blank=True,
        null=True,
        verbose_name="Especificar Otro Sector"
    )
    
    # ALCANCE GEOGR√ÅFICO
    alcance_servicio = models.CharField(
        max_length=20,
        choices=[
            ('local', 'Local'),
            ('nacional', 'Nacional'),
            ('internacional', 'Internacional'),
        ],
        verbose_name="Alcance del Servicio"
    )
    paises_trabaja = models.CharField(
        max_length=500,
        blank=True,
        null=True,
        verbose_name="Pa√≠ses con los que Trabaja",
        help_text="Si aplica, listar pa√≠ses separados por comas"
    )
    
    # EXPORTACI√ìN DE SERVICIOS
    exporta_servicios = models.BooleanField(
        null=True,
        blank=True,
        verbose_name="¬øExporta Servicios?",
        help_text="Marque si la empresa exporta servicios"
    )
    interes_exportar_servicios = models.BooleanField(
        null=True,
        blank=True,
        verbose_name="¬øInter√©s en Exportar Servicios?",
        help_text="Marque si tiene inter√©s en exportar servicios"
    )
    
    # IDIOMAS DE TRABAJO
    idiomas_trabajo = models.CharField(
        max_length=200,
        blank=True,
        null=True,
        verbose_name="Idiomas con los que Trabaja",
        help_text="Espa√±ol, Ingl√©s, Portugu√©s, Otro (especificar)"
    )
    idioma_otro = models.CharField(
        max_length=200,
        blank=True,
        null=True,
        verbose_name="Especificar Otro Idioma"
    )
    
    # FORMA DE CONTRATACI√ìN
    forma_contratacion = models.CharField(
        max_length=20,
        choices=[
            ('hora', 'Por Hora'),
            ('proyecto', 'Por Proyecto'),
            ('mensual', 'Mensual'),
            ('otro', 'Otro'),
        ],
        verbose_name="Forma de Contrataci√≥n"
    )
    forma_contratacion_otro = models.CharField(
        max_length=200,
        blank=True,
        null=True,
        verbose_name="Especificar Otra Forma de Contrataci√≥n"
    )
    
    # CERTIFICACIONES T√âCNICAS
    certificaciones_tecnicas = models.CharField(
        max_length=500,
        blank=True,
        null=True,
        verbose_name="Certificaciones T√©cnicas",
        help_text="ISO 9001, ISO 14001, SCRUM, AWS, etc. Separar por comas"
    )
    tiene_equipo_tecnico = models.BooleanField(
        null=True,
        blank=True,
        verbose_name="¬øTiene Equipo T√©cnico Especializado?",
        help_text="Marque si tiene equipo t√©cnico especializado"
    )
    equipo_tecnico_formacion = models.BooleanField(
        null=True,
        blank=True,
        verbose_name="¬øEquipo en Formaci√≥n?",
        help_text="Marque si el equipo est√° en formaci√≥n"
    )
    
    es_principal = models.BooleanField(
        default=False, 
        verbose_name="Servicio Principal"
    )
    
    # Campos de auditor√≠a (heredados de TimestampedModel)
    
    class Meta:
        db_table = 'servicio_empresa_mixta'
        verbose_name = 'Servicio de Empresa Mixta'
        verbose_name_plural = 'Servicios de Empresas Mixtas'
        ordering = ['-es_principal', 'nombre_servicio']
    
    def __str__(self):
        return f"{self.nombre_servicio} - {self.empresa.razon_social}"

class PosicionArancelariaMixta(models.Model):
    """
    Modelo para posiciones arancelarias de productos de empresas mixtas
    """
    producto = models.ForeignKey(
        ProductoEmpresaMixta, 
        on_delete=models.CASCADE, 
        related_name='posiciones_arancelarias',
        verbose_name="Producto"
    )
    codigo_arancelario = models.CharField(
        max_length=20,
        verbose_name="C√≥digo Arancelario"
    )
    descripcion_arancelaria = models.CharField(
        max_length=300,
        blank=True,
        null=True,
        verbose_name="Descripci√≥n Arancelaria"
    )
    es_principal = models.BooleanField(
        default=False, 
        verbose_name="Posici√≥n Principal"
    )
    
    # Campos de auditor√≠a (heredados de TimestampedModel)
    
    class Meta:
        db_table = 'posicion_arancelaria_mixta'
        verbose_name = 'Posici√≥n Arancelaria Mixta'
        verbose_name_plural = 'Posiciones Arancelarias Mixtas'
        ordering = ['-es_principal', 'codigo_arancelario']
    
    def __str__(self):
        return f"{self.codigo_arancelario} - {self.producto.nombre_producto}"
```

7. SISTEMA DE AUDITOR√çA (INTEGRADO):
====================================

```python
# apps/auditoria/models.py
from django.db import models
from apps.core.models import Usuario

class AuditoriaLog(models.Model):
    """
    Modelo principal para registrar todas las acciones del sistema
    """
    
    # Informaci√≥n b√°sica del evento
    timestamp = models.DateTimeField(auto_now_add=True, verbose_name="Fecha y Hora")
    usuario = models.ForeignKey(
        Usuario, 
        on_delete=models.SET_NULL, 
        null=True, 
        blank=True,
        verbose_name="Usuario",
        help_text="Usuario que realiz√≥ la acci√≥n (puede ser NULL para acciones del sistema)"
    )
    
    # Informaci√≥n de la sesi√≥n
    session_key = models.CharField(
        max_length=40, 
        blank=True, 
        null=True,
        verbose_name="Clave de Sesi√≥n"
    )
    user_agent = models.TextField(
        blank=True, 
        null=True,
        verbose_name="User Agent",
        help_text="Informaci√≥n del navegador/dispositivo"
    )
    
    # Informaci√≥n de la acci√≥n
    accion = models.CharField(
        max_length=50,
        choices=[
            ('CREATE', 'Crear'),
            ('READ', 'Leer'),
            ('UPDATE', 'Actualizar'),
            ('DELETE', 'Eliminar'),
            ('LOGIN', 'Iniciar Sesi√≥n'),
            ('LOGOUT', 'Cerrar Sesi√≥n'),
            ('EXPORT', 'Exportar'),
            ('IMPORT', 'Importar'),
            ('LOGIN_FAILED', 'Intento de Login Fallido'),
            ('PASSWORD_CHANGE', 'Cambio de Contrase√±a'),
            ('PASSWORD_RESET', 'Restablecer Contrase√±a'),
            ('PERMISSION_DENIED', 'Acceso Denegado'),
            ('FILE_UPLOAD', 'Subir Archivo'),
            ('FILE_DOWNLOAD', 'Descargar Archivo'),
            ('EMAIL_SENT', 'Email Enviado'),
            ('EMAIL_FAILED', 'Email Fallido'),
            ('SYSTEM_ERROR', 'Error del Sistema'),
        ],
        verbose_name="Acci√≥n Realizada"
    )
    
    # Informaci√≥n del objeto afectado
    modelo_afectado = models.CharField(
        max_length=100,
        verbose_name="Modelo Afectado",
        help_text="Nombre del modelo Django afectado"
    )
    objeto_id = models.PositiveIntegerField(
        null=True, 
        blank=True,
        verbose_name="ID del Objeto",
        help_text="ID del objeto espec√≠fico afectado"
    )
    nombre_objeto = models.CharField(
        max_length=200,
        blank=True,
        null=True,
        verbose_name="Nombre del Objeto",
        help_text="Nombre descriptivo del objeto (ej: raz√≥n social de empresa)"
    )
    
    # Detalles de la acci√≥n
    descripcion = models.TextField(
        verbose_name="Descripci√≥n",
        help_text="Descripci√≥n detallada de la acci√≥n realizada"
    )
    detalles_adicionales = models.JSONField(
        default=dict,
        blank=True,
        verbose_name="Detalles Adicionales",
        help_text="Informaci√≥n adicional en formato JSON"
    )
    
    # Valores antes y despu√©s del cambio
    valores_anteriores = models.JSONField(
        default=dict,
        blank=True,
        verbose_name="Valores Anteriores",
        help_text="Valores del objeto antes del cambio"
    )
    valores_nuevos = models.JSONField(
        default=dict,
        blank=True,
        verbose_name="Valores Nuevos",
        help_text="Valores del objeto despu√©s del cambio"
    )
    
    # Informaci√≥n de contexto
    url = models.URLField(
        blank=True, 
        null=True,
        verbose_name="URL",
        help_text="URL donde se realiz√≥ la acci√≥n"
    )
    metodo_http = models.CharField(
        max_length=10,
        blank=True,
        null=True,
        verbose_name="M√©todo HTTP",
        help_text="GET, POST, PUT, DELETE, etc."
    )
    
    # Clasificaci√≥n de la acci√≥n
    nivel_criticidad = models.CharField(
        max_length=20,
        choices=[
            ('INFO', 'Informativo'),
            ('WARNING', 'Advertencia'),
            ('ERROR', 'Error'),
            ('CRITICAL', 'Cr√≠tico'),
        ],
        default='INFO',
        verbose_name="Nivel de Criticidad"
    )
    categoria = models.CharField(
        max_length=50,
        choices=[
            ('AUTHENTICATION', 'Autenticaci√≥n'),
            ('USER_MANAGEMENT', 'Gesti√≥n de Usuarios'),
            ('COMPANY_MANAGEMENT', 'Gesti√≥n de Empresas'),
            ('DATA_EXPORT', 'Exportaci√≥n de Datos'),
            ('DATA_IMPORT', 'Importaci√≥n de Datos'),
            ('FILE_MANAGEMENT', 'Gesti√≥n de Archivos'),
            ('SYSTEM_ADMIN', 'Administraci√≥n del Sistema'),
            ('SECURITY', 'Seguridad'),
            ('ERROR', 'Errores'),
        ],
        verbose_name="Categor√≠a"
    )
    
    # Informaci√≥n de resultado
    exito = models.BooleanField(
        default=True,
        verbose_name="√âxito",
        help_text="Indica si la acci√≥n fue exitosa"
    )
    mensaje_error = models.TextField(
        blank=True,
        null=True,
        verbose_name="Mensaje de Error",
        help_text="Mensaje de error si la acci√≥n fall√≥"
    )
    
    class Meta:
        db_table = 'auditoria_log'
        verbose_name = 'Registro de Auditor√≠a'
        verbose_name_plural = 'Registros de Auditor√≠a'
        ordering = ['-timestamp']
        indexes = [
            models.Index(fields=['timestamp']),
            models.Index(fields=['usuario']),
            models.Index(fields=['accion']),
            models.Index(fields=['modelo_afectado']),
            models.Index(fields=['categoria']),
            models.Index(fields=['nivel_criticidad']),
        ]
    
    def __str__(self):
        return f"{self.timestamp} - {self.usuario} - {self.accion} - {self.modelo_afectado}"

class AuditoriaCambios(models.Model):
    """
    Modelo espec√≠fico para auditor√≠a de cambios en objetos
    """
    auditoria_log = models.ForeignKey(
        AuditoriaLog, 
        on_delete=models.CASCADE,
        related_name='cambios_detallados',
        verbose_name="Registro de Auditor√≠a"
    )
    
    campo_modificado = models.CharField(
        max_length=100,
        verbose_name="Campo Modificado"
    )
    valor_anterior = models.TextField(
        blank=True,
        null=True,
        verbose_name="Valor Anterior"
    )
    valor_nuevo = models.TextField(
        blank=True,
        null=True,
        verbose_name="Valor Nuevo"
    )
    
    class Meta:
        db_table = 'auditoria_cambios'
        verbose_name = 'Cambio Detallado'
        verbose_name_plural = 'Cambios Detallados'
        ordering = ['campo_modificado']
    
    def __str__(self):
        return f"{self.campo_modificado}: {self.valor_anterior} ‚Üí {self.valor_nuevo}"

class AuditoriaArchivos(models.Model):
    """
    Modelo para auditor√≠a espec√≠fica de archivos
    """
    auditoria_log = models.ForeignKey(
        AuditoriaLog, 
        on_delete=models.CASCADE,
        related_name='archivos_afectados',
        verbose_name="Registro de Auditor√≠a"
    )
    
    nombre_archivo = models.CharField(
        max_length=255,
        verbose_name="Nombre del Archivo"
    )
    ruta_archivo = models.CharField(
        max_length=500,
        verbose_name="Ruta del Archivo"
    )
    tama√±o_archivo = models.BigIntegerField(
        null=True,
        blank=True,
        verbose_name="Tama√±o del Archivo (bytes)"
    )
    tipo_archivo = models.CharField(
        max_length=50,
        verbose_name="Tipo de Archivo"
    )
    hash_archivo = models.CharField(
        max_length=64,
        blank=True,
        null=True,
        verbose_name="Hash del Archivo",
        help_text="Hash SHA-256 para verificar integridad"
    )
    
    class Meta:
        db_table = 'auditoria_archivos'
        verbose_name = 'Archivo Auditado'
        verbose_name_plural = 'Archivos Auditados'
        ordering = ['-auditoria_log__timestamp']
    
    def __str__(self):
        return f"{self.nombre_archivo} - {self.auditoria_log.timestamp}"
```

8. SISTEMA DE FILTROS Y EXPORTACI√ìN:
====================================

```python
# apps/empresas/filters.py
import django_filters
from django import forms
from .models import Empresaproducto, Empresaservicio, Rubro

class EmpresaProductoFilter(django_filters.FilterSet):
    # Filtros textuales
    razon_social = django_filters.CharFilter(
        lookup_expr='icontains',
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Buscar por raz√≥n social...'})
    )
    
    # Filtro por productos espec√≠ficos
    producto = django_filters.CharFilter(
        field_name='productos__nombre_producto',
        lookup_expr='icontains',
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Buscar por producto...'})
    )
    
    # Filtro por descripci√≥n de empresa
    descripcion = django_filters.CharFilter(
        field_name='observaciones',
        lookup_expr='icontains',
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Buscar por descripci√≥n...'})
    )
    
    telefono = django_filters.CharFilter(
        lookup_expr='icontains',
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Buscar por tel√©fono...'})
    )
    
    correo = django_filters.CharFilter(
        lookup_expr='icontains',
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Buscar por email...'})
    )
    
    direccion = django_filters.CharFilter(
        lookup_expr='icontains',
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Buscar por direcci√≥n...'})
    )
    
    cuit_cuil = django_filters.CharFilter(
        lookup_expr='icontains',
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Buscar por CUIT...'})
    )
    
    # Filtros de ubicaci√≥n
    departamento = django_filters.CharFilter(
        lookup_expr='icontains',
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Buscar por departamento...'})
    )
    
    municipio = django_filters.CharFilter(
        lookup_expr='icontains',
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Buscar por municipio...'})
    )
    
    localidad = django_filters.CharFilter(
        lookup_expr='icontains',
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Buscar por localidad...'})
    )
    
    # Filtros booleanos
    certificadopyme = django_filters.BooleanFilter(
        widget=forms.Select(attrs={'class': 'form-control'}, choices=[('', 'Todos'), (True, 'S√≠'), (False, 'No')])
    )
    
    exporta = django_filters.BooleanFilter(
        widget=forms.Select(attrs={'class': 'form-control'}, choices=[('', 'Todos'), (True, 'S√≠'), (False, 'No')])
    )
    
    promo2idiomas = django_filters.BooleanFilter(
        widget=forms.Select(attrs={'class': 'form-control'}, choices=[('', 'Todos'), (True, 'S√≠'), (False, 'No')])
    )
    
    importa = django_filters.BooleanFilter(
        widget=forms.Select(attrs={'class': 'form-control'}, choices=[('', 'Todos'), (True, 'S√≠'), (False, 'No')])
    )
    
    # Filtros de texto libre
    destinoexporta = django_filters.CharFilter(
        lookup_expr='icontains',
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Destino de exportaci√≥n...'})
    )
    
    # Filtros por ferias
    feriasnacionales = django_filters.CharFilter(
        field_name='ferias__nombre_feria',
        lookup_expr='icontains',
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Ferias nacionales...'})
    )
    
    feriasinternacionales = django_filters.CharFilter(
        field_name='ferias__nombre_feria',
        lookup_expr='icontains',
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Ferias internacionales...'})
    )
    
    certificaciones = django_filters.CharFilter(
        lookup_expr='icontains',
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Certificaciones...'})
    )
    
    # Filtro por capacidad productiva
    capacidadproductiva = django_filters.CharFilter(
        field_name='productos__capacidad_productiva',
        lookup_expr='icontains',
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Capacidad productiva...'})
    )
    
    # Filtro por rubro
    id_rubro = django_filters.ModelChoiceFilter(
        queryset=Rubro.objects.all(),
        widget=forms.Select(attrs={'class': 'form-control'}),
        label="Rubro"
    )
    
    class Meta:
        model = Empresaproducto
        fields = [
            'razon_social', 'producto', 'descripcion', 'telefono', 'correo', 
            'direccion', 'cuit_cuil', 'departamento', 'municipio', 'localidad',
            'certificadopyme', 'exporta', 'promo2idiomas', 'importa',
            'destinoexporta', 'feriasnacionales', 'feriasinternacionales',
            'certificaciones', 'capacidadproductiva', 'id_rubro'
        ]
```

9. CONFIGURACI√ìN FINAL:
========================

```python
# settings.py
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    
    # Aplicaciones locales
    'apps.core',            # ‚Üê USUARIOS, ROLES, UBICACIONES
    'apps.empresas',        # ‚Üê CONTIENE TODO LO RELACIONADO CON EMPRESAS
    'apps.auditoria',       # ‚Üê SISTEMA DE AUDITOR√çA
    'apps.registro',        # ‚Üê REGISTRO P√öBLICO DE EMPRESAS
    
    # Aplicaciones de terceros
    'django_filters',
    'django_redis',         # ‚Üê CACHE REDIS
    'rest_framework',      # ‚Üê API REST
    'captcha',             # ‚Üê CAPTCHA PARA REGISTRO
]

# Configuraci√≥n de usuario personalizado
AUTH_USER_MODEL = 'core.Usuario'

# Configuraci√≥n de auditor√≠a
AUDITORIA_ENABLED = True
AUDITORIA_LOG_LEVEL = 'INFO'

# Configuraci√≥n para django-filter
FILTERS_EMPTY_CHOICE_LABEL = "Todos"
```

10. VALIDADORES Y UTILIDADES:
============================

```python
# apps/core/validators.py
from django.core.exceptions import ValidationError
import re

def validate_cuit(value):
    """Validar CUIT/CUIL argentino"""
    if not re.match(r'^\d{11}$', value):
        raise ValidationError('CUIT debe tener exactamente 11 d√≠gitos')
    
    # Validar d√≠gito verificador
    # ... l√≥gica de validaci√≥n CUIT ...

def validate_telefono_argentino(value):
    """Validar tel√©fono argentino"""
    if not re.match(r'^\+?54\d{10}$', value):
        raise ValidationError('Formato de tel√©fono argentino inv√°lido')

# apps/core/cache.py
from django.core.cache import cache
from django.conf import settings

class EmpresaCache:
    """Sistema de cache para empresas"""
    
    @staticmethod
    def get_empresas_por_departamento(departamento_id):
        cache_key = f"empresas_departamento_{departamento_id}"
        empresas = cache.get(cache_key)
        
        if not empresas:
            from .models import Empresaproducto
            empresas = Empresaproducto.objects.filter(
                departamento_id=departamento_id
            ).select_related('departamento', 'municipio')
            cache.set(cache_key, empresas, 3600)  # 1 hora
        
        return empresas
```

11. MIGRACIONES PARA ROLES:
===========================

```python
# 0001_crear_sistema_roles.py
from django.db import migrations, models
import django.db.models.deletion

class Migration(migrations.Migration):
    dependencies = [
        ('core', '0001_initial'),
    ]

    operations = [
        # Crear tabla RolUsuario
        migrations.CreateModel(
            name='RolUsuario',
            fields=[
                ('id', models.BigAutoField(primary_key=True, serialize=False)),
                ('nombre', models.CharField(max_length=50, unique=True, verbose_name='Nombre del Rol')),
                ('descripcion', models.TextField(verbose_name='Descripci√≥n')),
                ('puede_crear_empresas', models.BooleanField(default=False, verbose_name='Puede Crear Empresas')),
                ('puede_editar_empresas', models.BooleanField(default=False, verbose_name='Puede Editar Empresas')),
                ('puede_eliminar_empresas', models.BooleanField(default=False, verbose_name='Puede Eliminar Empresas')),
                ('puede_ver_auditoria', models.BooleanField(default=False, verbose_name='Puede Ver Auditor√≠a')),
                ('puede_exportar_datos', models.BooleanField(default=True, verbose_name='Puede Exportar Datos')),
                ('puede_importar_datos', models.BooleanField(default=False, verbose_name='Puede Importar Datos')),
                ('puede_gestionar_usuarios', models.BooleanField(default=False, verbose_name='Puede Gestionar Usuarios')),
                ('puede_acceder_admin', models.BooleanField(default=False, verbose_name='Puede Acceder al Admin')),
                ('nivel_acceso', models.IntegerField(choices=[(1, 'Consulta'), (2, 'Analista'), (3, 'Administrador')], default=1, verbose_name='Nivel de Acceso')),
                ('activo', models.BooleanField(default=True, verbose_name='Activo')),
                ('fecha_creacion', models.DateTimeField(auto_now_add=True, verbose_name='Fecha de Creaci√≥n')),
            ],
            options={
                'verbose_name': 'Rol de Usuario',
                'verbose_name_plural': 'Roles de Usuario',
                'db_table': 'rol_usuario',
                'ordering': ['nivel_acceso', 'nombre'],
            },
        ),
        
        # Crear tabla TipoEmpresa
        migrations.CreateModel(
            name='TipoEmpresa',
            fields=[
                ('id', models.BigAutoField(primary_key=True, serialize=False)),
                ('nombre', models.CharField(max_length=50, unique=True, verbose_name='Nombre del Tipo')),
                ('descripcion', models.TextField(verbose_name='Descripci√≥n')),
                ('activo', models.BooleanField(default=True, verbose_name='Activo')),
            ],
            options={
                'verbose_name': 'Tipo de Empresa',
                'verbose_name_plural': 'Tipos de Empresa',
                'db_table': 'tipo_empresa',
                'ordering': ['nombre'],
            },
        ),
        
        # Agregar campo rol a Usuario
        migrations.AddField(
            model_name='usuario',
            name='rol',
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.PROTECT, 
                to='core.rolusuario', 
                verbose_name='Rol del Usuario'
            ),
        ),
        
        # Crear datos iniciales
        migrations.RunSQL(
            """
            INSERT INTO rol_usuario (nombre, descripcion, puede_crear_empresas, puede_editar_empresas, 
                                   puede_eliminar_empresas, puede_ver_auditoria, puede_exportar_datos, 
                                   puede_importar_datos, puede_gestionar_usuarios, puede_acceder_admin, 
                                   nivel_acceso, activo, fecha_creacion) 
            VALUES 
            ('Administrador', 'Acceso completo y control total del sistema', true, true, true, true, true, true, true, true, 3, true, NOW()),
            ('Analista', 'Gesti√≥n y consulta de datos', true, true, false, true, true, true, false, true, 2, true, NOW()),
            ('Consulta', 'Visualizaci√≥n y exportaci√≥n, sin modificar informaci√≥n', false, false, false, false, true, false, false, false, 1, true, NOW());
            """,
            reverse_sql="DELETE FROM rol_usuario WHERE nombre IN ('Administrador', 'Analista', 'Consulta');"
        ),
        
        migrations.RunSQL(
            """
            INSERT INTO tipo_empresa (nombre, descripcion, activo) 
            VALUES 
            ('Producto', 'Empresa que solo vende productos', true),
            ('Servicio', 'Empresa que solo ofrece servicios', true),
            ('Mixta', 'Empresa que vende productos y ofrece servicios', true);
            """,
            reverse_sql="DELETE FROM tipo_empresa WHERE nombre IN ('Producto', 'Servicio', 'Mixta');"
        ),
    ]
```

================================================================================
                    SISTEMA DE DROPDOWNS DEPENDIENTES Y M√âTRICAS
================================================================================

SISTEMA DE UBICACI√ìN CON DROPDOWNS DEPENDIENTES:
================================================

```python
# apps/core/models.py - Modelos optimizados para dropdowns dependientes

class Dpto(models.Model):
    """
    Modelo para departamentos (usando datos de dpto.csv)
    """
    coddpto = models.CharField(max_length=10, unique=True, verbose_name="C√≥digo Departamento")
    nomdpto = models.CharField(max_length=100, verbose_name="Nombre del Departamento")
    codprov = models.CharField(max_length=10, verbose_name="C√≥digo Provincia")
    activo = models.BooleanField(default=True, verbose_name="Activo")
    
    class Meta:
        db_table = 'dpto'
        verbose_name = 'Departamento'
        verbose_name_plural = 'Departamentos'
        ordering = ['nomdpto']
    
    def __str__(self):
        return self.nomdpto

class Municipio(models.Model):
    """
    Modelo para municipios (usando datos de municipio.csv)
    """
    codmun = models.CharField(max_length=10, unique=True, verbose_name="C√≥digo Municipio")
    nommun = models.CharField(max_length=100, verbose_name="Nombre del Municipio")
    coddpto = models.CharField(max_length=10, verbose_name="C√≥digo Departamento")
    codprov = models.CharField(max_length=10, verbose_name="C√≥digo Provincia")
    dpto = models.ForeignKey(Dpto, on_delete=models.CASCADE, related_name='municipios')
    activo = models.BooleanField(default=True, verbose_name="Activo")
    
    class Meta:
        db_table = 'municipio'
        verbose_name = 'Municipio'
        verbose_name_plural = 'Municipios'
        ordering = ['nommun']
    
    def __str__(self):
        return f"{self.nommun} - {self.dpto.nomdpto}"

class Localidades(models.Model):
    """
    Modelo para localidades (usando datos de localidades.csv)
    """
    codloc = models.CharField(max_length=20, unique=True, verbose_name="C√≥digo Localidad")
    codlocsv = models.CharField(max_length=10, verbose_name="C√≥digo Localidad SV")
    nomloc = models.CharField(max_length=100, verbose_name="Nombre de la Localidad")
    codmun = models.CharField(max_length=10, verbose_name="C√≥digo Municipio")
    coddpto = models.CharField(max_length=10, verbose_name="C√≥digo Departamento")
    codprov = models.CharField(max_length=10, verbose_name="C√≥digo Provincia")
    codpais = models.CharField(max_length=10, verbose_name="C√≥digo Pa√≠s")
    latitud = models.DecimalField(max_digits=10, decimal_places=8, verbose_name="Latitud")
    longitud = models.DecimalField(max_digits=11, decimal_places=8, verbose_name="Longitud")
    codpos = models.CharField(max_length=10, verbose_name="C√≥digo Postal")
    municipio = models.ForeignKey(Municipio, on_delete=models.CASCADE, related_name='localidades')
    activo = models.BooleanField(default=True, verbose_name="Activo")
    
    class Meta:
        db_table = 'localidades'
        verbose_name = 'Localidad'
        verbose_name_plural = 'Localidades'
        ordering = ['nomloc']
    
    def __str__(self):
        return f"{self.nomloc} - {self.municipio.nommun}"
```

SISTEMA DE M√âTRICAS Y FILTROS OPTIMIZADO:
==========================================

```python
# apps/empresas/analytics.py
from django.db.models import Count, Q, Avg, Sum
from django.db.models.functions import Extract
from .models import Empresaproducto, Empresaservicio, EmpresaMixta

class MetricasEmpresas:
    """
    Clase para generar m√©tricas y estad√≠sticas de empresas
    """
    
    @staticmethod
    def get_metricas_generales():
        """M√©tricas generales del sistema"""
        return {
            'total_empresas': Empresaproducto.objects.count() + Empresaservicio.objects.count() + EmpresaMixta.objects.count(),
            'empresas_exportadoras': Empresaproducto.objects.filter(exporta='S√≠').count() + 
                                   Empresaservicio.objects.filter(exporta='S√≠').count() + 
                                   EmpresaMixta.objects.filter(exporta='S√≠').count(),
            'empresas_con_certificaciones': Empresaproducto.objects.filter(certificacionesbool=True).count() + 
                                          Empresaservicio.objects.filter(certificacionesbool=True).count() + 
                                          EmpresaMixta.objects.filter(certificacionesbool=True).count(),
            'empresas_por_departamento': Empresaproducto.objects.values('departamento__nomdpto').annotate(
                total=Count('id')
            ).order_by('-total'),
            'capacidad_productiva_promedio': Empresaproducto.objects.aggregate(
                promedio=Avg('capacidadproductiva')
            )['promedio'],
        }
    
    @staticmethod
    def get_metricas_por_rubro():
        """M√©tricas agrupadas por rubro"""
        return Empresaproducto.objects.values('id_rubro__nombre').annotate(
            total=Count('id'),
            exportadoras=Count('id', filter=Q(exporta='S√≠')),
            con_certificaciones=Count('id', filter=Q(certificacionesbool=True)),
            capacidad_promedio=Avg('capacidadproductiva')
        ).order_by('-total')
    
    @staticmethod
    def get_metricas_geograficas():
        """M√©tricas geogr√°ficas"""
        return {
            'por_departamento': Empresaproducto.objects.values('departamento__nomdpto').annotate(
                total=Count('id'),
                exportadoras=Count('id', filter=Q(exporta='S√≠'))
            ).order_by('-total'),
            'por_municipio': Empresaproducto.objects.values('municipio__nommun').annotate(
                total=Count('id')
            ).order_by('-total')[:10],
        }
    
    @staticmethod
    def get_metricas_exportacion():
        """M√©tricas espec√≠ficas de exportaci√≥n"""
        return {
            'tipos_exportacion': Empresaproducto.objects.values('tipoexporta').annotate(
                total=Count('id')
            ).exclude(tipoexporta__isnull=True),
            'destinos_principales': Empresaproducto.objects.values('destinoexporta').annotate(
                total=Count('id')
            ).exclude(destinoexporta__isnull=True).order_by('-total')[:10],
            'empresas_interesadas_exportar': Empresaproducto.objects.filter(interes_exportar=True).count(),
        }
```

SISTEMA DE FILTROS AVANZADOS:
=============================

```python
# apps/empresas/filters.py - Filtros optimizados para m√©tricas

class EmpresaFilter(django_filters.FilterSet):
    # Filtros geogr√°ficos
    departamento = django_filters.ModelChoiceFilter(
        queryset=Dpto.objects.all(),
        field_name='departamento',
        widget=forms.Select(attrs={'class': 'form-control'})
    )
    municipio = django_filters.ModelChoiceFilter(
        queryset=Municipio.objects.all(),
        field_name='municipio',
        widget=forms.Select(attrs={'class': 'form-control'})
    )
    localidad = django_filters.ModelChoiceFilter(
        queryset=Localidades.objects.all(),
        field_name='localidad',
        widget=forms.Select(attrs={'class': 'form-control'})
    )
    
    # Filtros de capacidad productiva
    capacidad_minima = django_filters.NumberFilter(
        field_name='capacidadproductiva',
        lookup_expr='gte',
        widget=forms.NumberInput(attrs={'class': 'form-control'})
    )
    capacidad_maxima = django_filters.NumberFilter(
        field_name='capacidadproductiva',
        lookup_expr='lte',
        widget=forms.NumberInput(attrs={'class': 'form-control'})
    )
    
    # Filtros de exportaci√≥n
    exporta = django_filters.ChoiceFilter(
        choices=[('S√≠', 'S√≠'), ('No, solo ventas nacionales', 'No, solo ventas nacionales'), ('No, solo ventas locales', 'No, solo ventas locales')],
        widget=forms.Select(attrs={'class': 'form-control'})
    )
    
    # Filtros de certificaciones
    tiene_certificaciones = django_filters.BooleanFilter(
        field_name='certificacionesbool',
        widget=forms.Select(attrs={'class': 'form-control'}, choices=[('', 'Todos'), (True, 'S√≠'), (False, 'No')])
    )
    
    # Filtros de ferias
    participo_ferias_nacionales = django_filters.BooleanFilter(
        field_name='participoferianacional',
        widget=forms.Select(attrs={'class': 'form-control'}, choices=[('', 'Todos'), (True, 'S√≠'), (False, 'No')])
    )
    
    # Filtros de puntaje
    puntaje_minimo = django_filters.NumberFilter(
        field_name='puntaje',
        lookup_expr='gte',
        widget=forms.NumberInput(attrs={'class': 'form-control'})
    )
    
    class Meta:
        model = Empresaproducto
        fields = ['departamento', 'municipio', 'localidad', 'exporta', 'tiene_certificaciones', 
                 'participo_ferias_nacionales', 'capacidad_minima', 'capacidad_maxima', 'puntaje_minimo']
```

================================================================================
                    RESUMEN DE INTEGRACI√ìN COMPLETA - OPTIMIZADA PARA UX
================================================================================

‚úÖ **ESTRUCTURA INTEGRADA Y PROFESIONAL CON MEJOR UX:**

1. **SISTEMA DE ROLES PROFESIONAL:**
   - Administrador: acceso completo y control total
   - Analista: gesti√≥n y consulta de datos
   - Consulta: visualizaci√≥n y exportaci√≥n, sin modificar informaci√≥n

2. **ORGANIZACI√ìN L√ìGICA CORREGIDA:**
   - Rubro, UnidadMedida, Otrorubro ‚Üí PERTENECEN A EMPRESAS
   - Dpto, Municipio, Localidades ‚Üí COMPARTIDOS entre usuarios y empresas
   - Usuarios ‚Üí Sistema de roles profesional
   - Empresas ‚Üí Tipos claros (producto, servicio, mixta)

3. **MODELOS COMPLETOS CON UX OPTIMIZADA:**
   - Sistema de roles granular
   - EmpresaBase (modelo abstracto) con campos simplificados
   - Empresaproducto, Empresaservicio, EmpresaMixta
   - ProductoEmpresa, ServicioEmpresa
   - PosicionArancelaria (UNIVERSAL)
   - Sistema de auditor√≠a completo
   - Sistema de filtros y exportaci√≥n

4. **SISTEMAS SIMPLIFICADOS PARA MEJOR UX:**
   - **Ferias**: Campos booleanos + texto libre + archivos (en lugar de modelo separado)
   - **Contactos**: Campos directos en EmpresaBase (en lugar de modelo separado)
   - **Emails**: Campos directos en EmpresaBase (en lugar de modelo separado)
   - **Certificaciones**: Campos booleanos + texto libre + archivos
   - **Exportaci√≥n/Importaci√≥n**: Campos optimizados con opciones espec√≠ficas
   - **Geolocalizaci√≥n**: Coordenadas lat/lng para mapas interactivos
   - **Dropdowns Dependientes**: Dpto ‚Üí Municipio ‚Üí Localidad con datos reales

5. **SISTEMA DE M√âTRICAS Y FILTROS OPTIMIZADO:**
   - **√çndices de base de datos**: Optimizados para consultas r√°pidas
   - **Filtros avanzados**: Por ubicaci√≥n, capacidad, exportaci√≥n, certificaciones
   - **M√©tricas en tiempo real**: Estad√≠sticas por rubro, ubicaci√≥n, tipo de empresa
   - **An√°lisis geogr√°fico**: Distribuci√≥n por departamento/municipio
   - **An√°lisis de exportaci√≥n**: Destinos, tipos, empresas interesadas

‚úÖ **BENEFICIOS DE LA INTEGRACI√ìN OPTIMIZADA:**

üéØ **COHERENCIA TOTAL:**
- Sistema de roles granular y profesional
- Organizaci√≥n l√≥gica corregida
- Estructura coherente y escalable

üéØ **FUNCIONALIDAD COMPLETA:**
- Gesti√≥n completa de empresas
- Sistema de auditor√≠a robusto
- Filtros y exportaci√≥n avanzados
- **UX simplificada para usuarios finales**

üéØ **ESCALABILIDAD:**
- F√°cil agregar nuevos tipos de empresas
- F√°cil agregar nuevos atributos
- Sistema de auditor√≠a extensible

üéØ **MANTENIBILIDAD:**
- C√≥digo organizado y documentado
- Relaciones claras y consistentes
- Validaciones robustas

üéØ **EXPERIENCIA DE USUARIO SUPERIOR:**
- **Formularios m√°s simples**: Campos directos en lugar de modelos separados
- **Menos clics**: Todo en una sola pantalla
- **Validaci√≥n inteligente**: Pregunta SI/NO, luego detalles
- **Texto libre**: Flexibilidad para escribir cualquier informaci√≥n
- **Opciones claras**: Choices para campos espec√≠ficos
- **Mapas interactivos**: Selecci√≥n de ubicaci√≥n visual
- **Dropdowns dependientes**: Navegaci√≥n intuitiva por ubicaci√≥n
- **Subida de archivos**: Certificaciones y ferias con documentos

üéØ **AN√ÅLISIS Y M√âTRICAS AVANZADAS:**
- **Filtros potentes**: B√∫squeda por m√∫ltiples criterios
- **Estad√≠sticas en tiempo real**: Dashboards con m√©tricas actualizadas
- **An√°lisis geogr√°fico**: Distribuci√≥n y concentraci√≥n de empresas
- **An√°lisis de exportaci√≥n**: Tendencias y oportunidades
- **Reportes personalizados**: Exportaci√≥n de datos filtrados

Esta estructura definitiva integrada es **profesional**, **completa**, **escalable** y
**optimizada para la experiencia del usuario**, preparada para un proyecto empresarial
de alto nivel con sistema de roles granular, organizaci√≥n l√≥gica corregida y UX superior.

================================================================================
